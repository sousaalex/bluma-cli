# BluMa CLI — BluMa.md

## Project Overview
BluMa CLI is an advanced terminal-based independent agent for automation and software engineering workflows. It offers a conversational assistant with a rich React/Ink CLI, leveraging LLMs (Azure OpenAI, compatible endpoints), supporting extensibility with plugins/tools, context management, persistent history, session workflow, smart decision/feedback systems, and interactive confirmations.

---

## Technology Stack  
- **Language:** TypeScript (ESM)
- **Runtime:** Node.js >= 18
- **CLI UI:** React 18 via Ink 5, ink-text-input, ink-spinner, ink-big-text
- **Bundler:** esbuild (config/scripts/build.js)
- **Transpiler:** Babel (babel.config.cjs)
- **Test Runner:** Jest 30 + babel-jest (jest.config.cjs)
- **Agent/LLM:** Azure OpenAI/OpenAI SDK + MCP (@modelcontextprotocol/sdk)
- **Config:** JSON, dotenv
- **Utilities:** uuid, diff, react-devtools-core, update-notifier

---

## Directory Map & Annotations
```
bluma-engineer/
├── package.json         # Stack, dependencies, scripts, CLI main/bin: dist/main.js
├── tsconfig.json        # TypeScript strict config, JSX=react, esm
├── babel.config.cjs     # Babel (env, typescript)
├── jest.config.cjs      # Jest/Babel testing config (tests/**/*.spec.ts, ts/tsx)
├── scripts/
│   └── build.js         # esbuild bundler; bundles src/main.ts, copies config to dist/
├── src/
│   ├── main.ts          # CLI & UI entry point (Ink renderer, App integration)
│   └── app/
│        ├── agent/      # Agent core (session, subagents, tools, config, feedback)
│        │     ├── config/     # JSON config for MCP, native tools, etc.
│        │     ├── subagents/  # Modular agent logic (init/boot, LLM, registry, types)
│        │     ├── core/       # Context API, LLM, prompt builders
│        │     ├── tools/      # Native and MCP tool plugins (typescript)
│        │     ├── feedback/   # Feedback and heuristics
│        │     └── utils/      # Utility functions (history, updates)
│        ├── ui/         # React/Ink CLI UI, custom components, layouts
│        │     ├── components/   # Prompt & tool renderers, UI widgets
│        │     ├── utils/        # CLI helpers (slash commands, buffer, etc.)
│        └── protocols/  # Protocol implementations & helpers (some Python)
├── tests/               # Jest integration/unit/UX tests (*.spec.ts, *.spec.tsx)
├── docs/                # Project docs, branding
└── prd.md               # Project requirement/design doc
```

---

## Key Configurations & Scripts
- **package.json**:
    - `main`: dist/main.js (built CLI entry)
    - `bin`: { "bluma": "dist/main.js" }
    - `scripts`: build, start, test, prepack, test:watch
    - **Dependencies**: @modelcontextprotocol/sdk, openai, ink, dotenv, mcps, utilities
    - **DevDependencies**: babel, jest, esbuild, types, React
- **scripts/build.js**: Uses esbuild to bundle src/main.ts, writes Node shebang, copies config from src/app/agent/config/ to dist/config.
- **src/app/agent/config/bluma-mcp.json**: MCP server configs for reasoning, Notion API, Upstash Context7.
- **src/app/agent/config/native_tools.json**: JSON definitions for native tool functions (shell_command, edit_tool, etc).

---

## Useful CLI Commands
- `npm install -g @nomad-e/bluma-cli`   # Global install
- `npm run build`                       # Build CLI (to dist/)
- `npm start`                           # Run CLI (after build)
- `npx bluma`                           # Run directly if published
- `npm test` / `npm run test:watch`     # Run/Watch Jest tests

When installed globally, start with `bluma` in terminal.

---

## Operational/Development Notes
- **.env required** for API keys/secrets — see README for full env var list.
- CI/CD and build process uses esbuild; ensure config is copied to dist.
- Tests are colocated under `/tests`, run via Jest (babel-jest for ts/tsx).
- Modular, extensible agent and tool architecture; see src/app/agent/subagents.
- Rich CLI UI in React/Ink, async session layer and feedback.
- Advanced overlay: live constraints/hints/overrides can be sent during agent operation via open channel CLI.
- Code and config auto-formatting is enforced on build and commit.

---

## Next Steps (BluMa/Agent-specific)
- Ensure .env is accurate and keys present for target stack (see README)
- For new plugins/tools, add under src/app/agent/tools or via MCP
- Use prd.md for high-level requirements/design
- See tests/ for BDD/behavioral examples, flows

---

*Autogenerated by BluMa InitSubAgent. All content based strictly on repository evidence as of 2025-08-05.*
